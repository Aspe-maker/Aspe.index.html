<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>لعبة ثلاثية الأبعاد بمسدس</title>
    <style>
        /* إعدادات الصفحة */
        body, html {
            margin: 0;
            padding: 0;
            overflow: hidden;
            font-family: Arial, sans-serif;
            background-color: #000;
        }

        /* عداد الحياة */
        #lifeCounter {
            position: absolute;
            top: 10px;
            left: 10px;
            font-size: 20px;
            color: white;
        }

        /* شاشة إعادة اللعب */
        #restartScreen {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            display: none;
            flex-direction: column;
        }

        /* توقيع المصمم */
        #designerSignature {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 12px;
            color: white;
        }

        /* لوحة التحكم */
        .controls {
            position: absolute;
            bottom: 20px;
            width: 100%;
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        .control-button {
            width: 50px;
            height: 50px;
            background-color: #333;
            color: white;
            border-radius: 5px;
            text-align: center;
            line-height: 50px;
            font-size: 18px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <!-- عداد الحياة -->
    <div id="lifeCounter">الحياة: 3</div>

    <!-- توقيع المصمم -->
    <div id="designerSignature">عبد الله لتصميم الألعاب عديمة الفائدة</div>

    <!-- شاشة إعادة اللعب -->
    <div id="restartScreen">
        <div>لقد ماتت! 😢</div>
        <button onclick="restartGame()">إعادة اللعب</button>
    </div>

    <!-- لوحة التحكم -->
    <div class="controls">
        <div class="control-button" onclick="movePlayer('left')">◀</div>
        <div class="control-button" onclick="movePlayer('right')">▶</div>
        <div class="control-button" onclick="shootBullet()">🔫</div>
    </div>

    <!-- مكتبة Three.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        // إعدادات اللعبة
        let scene, camera, renderer, ground;
        let player, enemy;
        let bullets = [];
        let enemies = [];
        let playerHealth = 3;

        function init() {
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            renderer = new THREE.WebGLRenderer();
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);

            // أرضية خضراء
            const groundGeometry = new THREE.PlaneGeometry(50, 50);
            const groundMaterial = new THREE.MeshBasicMaterial({ color: 0x00ff00 });
            ground = new THREE.Mesh(groundGeometry, groundMaterial);
            ground.rotation.x = -Math.PI / 2;
            scene.add(ground);

            // اللاعب
            player = new THREE.Mesh(
                new THREE.BoxGeometry(1, 1, 1),
                new THREE.MeshBasicMaterial({ color: 0x0000ff })
            );
            player.position.y = 0.5;
            player.position.z = 5;
            scene.add(player);

            // الكاميرا
            camera.position.set(0, 5, 15);
            camera.lookAt(0, 0, 0);

            // إضافة الأشجار
            for (let i = 0; i < 5; i++) {
                const tree = new THREE.Mesh(
                    new THREE.CylinderGeometry(0.5, 0.5, 3),
                    new THREE.MeshBasicMaterial({ color: 0x8B4513 })
                );
                const foliage = new THREE.Mesh(
                    new THREE.SphereGeometry(1.5),
                    new THREE.MeshBasicMaterial({ color: 0x006400 })
                );
                tree.position.set(Math.random() * 40 - 20, 1.5, Math.random() * -20);
                foliage.position.set(tree.position.x, 3.5, tree.position.z);
                scene.add(tree);
                scene.add(foliage);
            }

            // بدء ظهور الأعداء
            spawnEnemy();
            setInterval(spawnEnemy, 3000);

            updateLifeCounter();
            animate();
        }

        function updateLifeCounter() {
            document.getElementById('lifeCounter').textContent = 'الحياة: ' + playerHealth;
        }

        function spawnEnemy() {
            const newEnemy = new THREE.Mesh(
                new THREE.BoxGeometry(1, 1, 1),
                new THREE.MeshBasicMaterial({ color: 0xff0000 })
            );
            newEnemy.position.set(Math.random() * 20 - 10, 0.5, -10);
            enemies.push(newEnemy);
            scene.add(newEnemy);
        }

        function shootBullet() {
            const bullet = new THREE.Mesh(
                new THREE.SphereGeometry(0.1, 8, 8),
                new THREE.MeshBasicMaterial({ color: 0xffff00 })
            );
            bullet.position.set(player.position.x, player.position.y, player.position.z - 1);
            bullets.push(bullet);
            scene.add(bullet);
        }

        function checkCollision(bullet, enemy) {
            const distance = bullet.position.distanceTo(enemy.position);
            return distance < 0.5;
        }

        function showRestartScreen() {
            document.getElementById('restartScreen').style.display = 'flex';
        }

        function restartGame() {
            playerHealth = 3;
            updateLifeCounter();
            document.getElementById('restartScreen').style.display = 'none';
            enemies.forEach(e => scene.remove(e));
            enemies = [];
        }

        function movePlayer(direction) {
            const speed = 0.5;
            if (direction === 'left') player.position.x -= speed;
            if (direction === 'right') player.position.x += speed;
        }

        function animate() {
            requestAnimationFrame(animate);

            bullets.forEach((bullet, index) => {
                bullet.position.z -= 0.5;
                if (bullet.position.z < -10) {
                    scene.remove(bullet);
                    bullets.splice(index, 1);
                } else {
                    enemies.forEach((enemy, enemyIndex) => {
                        if (checkCollision(bullet, enemy)) {
                            scene.remove(bullet);
                            scene.remove(enemy);
                            bullets.splice(index, 1);
                            enemies.splice(enemyIndex, 1);
                        }
                    });
                }
            });

            enemies.forEach((enemy) => {
                enemy.position.z += 0.02;
                if (enemy.position.z > player.position.z) {
                    playerHealth -= 1;
                    updateLifeCounter();
                    scene.remove(enemy);
                    enemies.splice(enemies.indexOf(enemy), 1);
                    if (playerHealth <= 0) showRestartScreen();
                }
            });

            renderer.render(scene, camera);
        }

        window.addEventListener('keydown', (event) => {
            if (event.key === 'ArrowLeft') movePlayer('left');
            if (event.key === 'ArrowRight') movePlayer('right');
            if (event.key === ' ') shootBullet();
        });

        init();
    </script>
</body>
</html>
